import{_ as Ie}from"./@splinetool-C3olDjIi.js";import{a as Ze}from"./axios-CCb-kr4I.js";import{B as N,f as At,i as yt,h as Tt,a as _t,J as Nt,b as Qe,d as be,W as pt}from"./@ethersproject-w92F1kWw.js";import{_ as It}from"./sturdy-websocket-Bpjngt07.js";var l;(function(t){t.ETH_MAINNET="eth-mainnet",t.ETH_GOERLI="eth-goerli",t.ETH_SEPOLIA="eth-sepolia",t.OPT_MAINNET="opt-mainnet",t.OPT_GOERLI="opt-goerli",t.OPT_SEPOLIA="opt-sepolia",t.ARB_MAINNET="arb-mainnet",t.ARB_GOERLI="arb-goerli",t.ARB_SEPOLIA="arb-sepolia",t.MATIC_MAINNET="polygon-mainnet",t.MATIC_MUMBAI="polygon-mumbai",t.MATIC_AMOY="polygon-amoy",t.ASTAR_MAINNET="astar-mainnet",t.POLYGONZKEVM_MAINNET="polygonzkevm-mainnet",t.POLYGONZKEVM_TESTNET="polygonzkevm-testnet",t.POLYGONZKEVM_CARDONA="polygonzkevm-cardona",t.BASE_MAINNET="base-mainnet",t.BASE_GOERLI="base-goerli",t.BASE_SEPOLIA="base-sepolia",t.ZKSYNC_MAINNET="zksync-mainnet",t.ZKSYNC_SEPOLIA="zksync-sepolia",t.SHAPE_MAINNET="shape-mainnet",t.SHAPE_SEPOLIA="shape-sepolia",t.LINEA_MAINNET="linea-mainnet",t.LINEA_SEPOLIA="linea-sepolia",t.FANTOM_MAINNET="fantom-mainnet",t.FANTOM_TESTNET="fantom-testnet",t.ZETACHAIN_MAINNET="zetachain-mainnet",t.ZETACHAIN_TESTNET="zetachain-testnet",t.ARBNOVA_MAINNET="arbnova-mainnet",t.BLAST_MAINNET="blast-mainnet",t.BLAST_SEPOLIA="blast-sepolia",t.MANTLE_MAINNET="mantle-mainnet",t.MANTLE_SEPOLIA="mantle-sepolia",t.SCROLL_MAINNET="scroll-mainnet",t.SCROLL_SEPOLIA="scroll-sepolia",t.GNOSIS_MAINNET="gnosis-mainnet",t.GNOSIS_CHIADO="gnosis-chiado",t.BNB_MAINNET="bnb-mainnet",t.BNB_TESTNET="bnb-testnet",t.AVAX_MAINNET="avax-mainnet",t.AVAX_FUJI="avax-fuji",t.CELO_MAINNET="celo-mainnet",t.CELO_ALFAJORES="celo-alfajores",t.METIS_MAINNET="metis-mainnet",t.OPBNB_MAINNET="opbnb-mainnet",t.OPBNB_TESTNET="opbnb-testnet",t.BERACHAIN_BARTIO="berachain-bartio",t.SONEIUM_MINATO="soneium-minato"})(l||(l={}));var H;(function(t){t.DEFAULT_TOKENS="DEFAULT_TOKENS",t.ERC20="erc20"})(H||(H={}));var b;(function(t){t.EXTERNAL="external",t.INTERNAL="internal",t.ERC20="erc20",t.ERC721="erc721",t.ERC1155="erc1155",t.SPECIALNFT="specialnft"})(b||(b={}));var ue;(function(t){t.TO="TO",t.FROM="FROM"})(ue||(ue={}));var Oe;(function(t){t.ASCENDING="asc",t.DESCENDING="desc"})(Oe||(Oe={}));var he;(function(t){t.VERIFIED="verified",t.APPROVED="approved",t.REQUESTED="requested",t.NOT_REQUESTED="not_requested"})(he||(he={}));var O;(function(t){t.PENDING_TRANSACTIONS="alchemy_pendingTransactions",t.MINED_TRANSACTIONS="alchemy_minedTransactions"})(O||(O={}));var Re;(function(t){t.NATIVE="NATIVE",t.ERC20="ERC20",t.ERC721="ERC721",t.ERC1155="ERC1155",t.SPECIAL_NFT="SPECIAL_NFT"})(Re||(Re={}));var ke;(function(t){t.APPROVE="APPROVE",t.TRANSFER="TRANSFER"})(ke||(ke={}));var Se;(function(t){t.ETHERSCAN="ETHERSCAN"})(Se||(Se={}));var Pe;(function(t){t.CREATE="CREATE",t.CALL="CALL",t.STATICCALL="STATICCALL",t.DELEGATECALL="DELEGATECALL"})(Pe||(Pe={}));var Ce;(function(t){t.UNSPECIFIED="TRANSACTION_JOB_STATUS_UNSPECIFIED",t.IN_PROGRESS="IN_PROGRESS",t.COMPLETE="COMPLETE",t.ABANDONED="ABANDONED"})(Ce||(Ce={}));var we;(function(t){t.V1="V1",t.V2="V2"})(we||(we={}));var S;(function(t){t.MINED_TRANSACTION="MINED_TRANSACTION",t.DROPPED_TRANSACTION="DROPPED_TRANSACTION",t.ADDRESS_ACTIVITY="ADDRESS_ACTIVITY",t.NFT_ACTIVITY="NFT_ACTIVITY",t.NFT_METADATA_UPDATE="NFT_METADATA_UPDATE",t.GRAPHQL="GRAPHQL"})(S||(S={}));var Me;(function(t){t.PENDING="pending",t.LATEST="latest",t.SAFE="safe",t.FINALIZED="finalized",t.EARLIEST="earliest"})(Me||(Me={}));var Be;(function(t){t.CALL_TRACER="callTracer",t.PRESTATE_TRACER="prestateTracer"})(Be||(Be={}));var I;(function(t){t.ERC721="ERC721",t.ERC1155="ERC1155",t.NO_SUPPORTED_NFT_STANDARD="NO_SUPPORTED_NFT_STANDARD",t.NOT_A_CONTRACT="NOT_A_CONTRACT",t.UNKNOWN="UNKNOWN"})(I||(I={}));var Z;(function(t){t.Erc721TooManyOwners="Erc721TooManyOwners",t.Erc721TooManyTokens="Erc721TooManyTokens",t.Erc721DishonestTotalSupply="Erc721DishonestTotalSupply",t.MostlyHoneyPotOwners="MostlyHoneyPotOwners",t.OwnedByMostHoneyPots="OwnedByMostHoneyPots",t.LowDistinctOwnersPercent="LowDistinctOwnersPercent",t.HighHoneyPotOwnerPercent="HighHoneyPotOwnerPercent",t.HighHoneyPotPercent="HighHoneyPotPercent",t.HoneyPotsOwnMultipleTokens="HoneyPotsOwnMultipleTokens",t.NoSalesActivity="NoSalesActivity",t.HighAirdropPercent="HighAirdropPercent",t.Unknown="Unknown"})(Z||(Z={}));var Fe;(function(t){t.SPAM="SPAM",t.AIRDROPS="AIRDROPS"})(Fe||(Fe={}));var Le;(function(t){t.TRANSFERTIME="TRANSFERTIME"})(Le||(Le={}));var P;(function(t){t.SEAPORT="seaport",t.LOOKSRARE="looksrare",t.X2Y2="x2y2",t.WYVERN="wyvern",t.CRYPTOPUNKS="cryptopunks",t.BLUR="blur",t.UNKNOWN="unknown"})(P||(P={}));var Q;(function(t){t.BUYER="buyer",t.SELLER="seller"})(Q||(Q={}));var w;(function(t){t.DOES_NOT_EXIST="does_not_exist",t.ALREADY_QUEUED="already_queued",t.IN_PROGRESS="in_progress",t.FINISHED="finished",t.QUEUED="queued",t.QUEUE_FAILED="queue_failed"})(w||(w={}));var fe;(function(t){t.OPENSEA="OpenSea"})(fe||(fe={}));/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function a(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function d(h){try{c(r.next(h))}catch(m){o(m)}}function u(h){try{c(r.throw(h))}catch(m){o(m)}}function c(h){h.done?s(h.value):i(h.value).then(d,u)}c((r=r.apply(t,[])).next())})}function De(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function k(t){return this instanceof k?(this.v=t,this):new k(t)}function Te(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(v){return new Promise(function(C,L){s.push([f,v,C,L])>1||d(f,v)})})}function d(f,v){try{u(r[f](v))}catch(C){m(s[0][3],C)}}function u(f){f.value instanceof k?Promise.resolve(f.value.v).then(c,h):m(s[0][2],f)}function c(f){d("next",f)}function h(f){d("throw",f)}function m(f,v){f(v),s.shift(),s.length&&d(s[0][0],s[0][1])}}function Je(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof De=="function"?De(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(d,u){o=t[s](o),i(d,u,o.done,o.value)})}}function i(s,o,d,u){Promise.resolve(u).then(function(c){s({value:c,done:d})},o)}}const J="demo",et=l.ETH_MAINNET,bt=5,Ot=0;function tt(t,e){return`https://${t}.g.alchemy.com/v2/${e}`}function Rt(t,e){return`https://${t}.g.alchemy.com/nft/v3/${e}`}function kt(t,e){return`wss://${t}.g.alchemy.com/v2/${e}`}function St(){return"https://dashboard.alchemy.com/api"}var g;(function(t){t[t.BASE=0]="BASE",t[t.NFT=1]="NFT",t[t.WEBHOOK=2]="WEBHOOK"})(g||(g={}));const nt={[l.ETH_MAINNET]:"mainnet",[l.ETH_GOERLI]:"goerli",[l.ETH_SEPOLIA]:"sepolia",[l.OPT_MAINNET]:"optimism",[l.OPT_GOERLI]:"optimism-goerli",[l.OPT_SEPOLIA]:"optimism-sepolia",[l.ARB_MAINNET]:"arbitrum",[l.ARB_GOERLI]:"arbitrum-goerli",[l.ARB_SEPOLIA]:"arbitrum-sepolia",[l.MATIC_MAINNET]:"matic",[l.MATIC_MUMBAI]:"maticmum",[l.MATIC_AMOY]:"maticamoy",[l.ASTAR_MAINNET]:"astar-mainnet",[l.POLYGONZKEVM_MAINNET]:"polygonzkevm-mainnet",[l.POLYGONZKEVM_TESTNET]:"polygonzkevm-testnet",[l.POLYGONZKEVM_CARDONA]:"polygonzkevm-cardona",[l.BASE_MAINNET]:"base-mainnet",[l.BASE_GOERLI]:"base-goerli",[l.BASE_SEPOLIA]:"base-sepolia",[l.ZKSYNC_MAINNET]:"zksync-mainnet",[l.ZKSYNC_SEPOLIA]:"zksync-sepolia",[l.SHAPE_MAINNET]:"shape-mainnet",[l.SHAPE_SEPOLIA]:"shape-sepolia",[l.LINEA_MAINNET]:"linea-mainnet",[l.LINEA_SEPOLIA]:"linea-sepolia",[l.FANTOM_MAINNET]:"fantom-mainnet",[l.FANTOM_TESTNET]:"fantom-testnet",[l.ZETACHAIN_MAINNET]:"zetachain-mainnet",[l.ZETACHAIN_TESTNET]:"zetachain-testnet",[l.ARBNOVA_MAINNET]:"arbnova-mainnet",[l.BLAST_MAINNET]:"blast-mainnet",[l.BLAST_SEPOLIA]:"blast-sepolia",[l.MANTLE_MAINNET]:"mantle-mainnet",[l.MANTLE_SEPOLIA]:"mantle-sepolia",[l.SCROLL_MAINNET]:"scroll-mainnet",[l.SCROLL_SEPOLIA]:"scroll-sepolia",[l.GNOSIS_MAINNET]:"gnosis-mainnet",[l.GNOSIS_CHIADO]:"gnosis-chiado",[l.BNB_MAINNET]:"bnb-mainnet",[l.BNB_TESTNET]:"bnb-testnet",[l.AVAX_MAINNET]:"avax-mainnet",[l.AVAX_FUJI]:"avax-fuji",[l.CELO_MAINNET]:"celo-mainnet",[l.CELO_ALFAJORES]:"celo-alfajores",[l.METIS_MAINNET]:"metis-mainnet",[l.OPBNB_MAINNET]:"opbnb-mainnet",[l.OPBNB_TESTNET]:"opbnb-testnet",[l.BERACHAIN_BARTIO]:"berachain-bartio",[l.SONEIUM_MINATO]:"soneium-minato"},ee={"arbitrum-goerli":{chainId:421613,name:"arbitrum-goerli"},"arbitrum-sepolia":{chainId:421614,name:"arbitrum-sepolia"},"astar-mainnet":{chainId:592,name:"astar-mainnet"},sepolia:{chainId:11155111,name:"sepolia"},"optimism-sepolia":{chainId:11155420,name:"optimism-sepolia"},"polygonzkevm-mainnet":{chainId:1101,name:"polygonzkevm-mainnet"},"polygonzkevm-testnet":{chainId:1442,name:"polygonzkevm-testnet"},"polygonzkevm-cardona":{chainId:2442,name:"polygonzkevm-cardona"},"base-mainnet":{chainId:8453,name:"base-mainnet"},"base-goerli":{chainId:84531,name:"base-goerli"},"base-sepolia":{chainId:84532,name:"base-sepolia"},maticamoy:{chainId:80002,name:"maticamoy"},"zksync-mainnet":{chainId:324,name:"zksync-mainnet"},"zksync-sepolia":{chainId:300,name:"zksync-sepolia"},"shape-mainnet":{chainId:360,name:"shape-mainnet"},"shape-sepolia":{chainId:11011,name:"shape-sepolia"},"linea-mainnet":{chainId:59144,name:"linea-mainnet"},"linea-sepolia":{chainId:59141,name:"linea-sepolia"},"fantom-mainnet":{chainId:250,name:"fantom-mainnet"},"fantom-testnet":{chainId:4002,name:"fantom-testnet"},"zetachain-mainnet":{chainId:7e3,name:"zetachain-mainnet"},"zetachain-testnet":{chainId:7001,name:"zetachain-testnet"},"arbnova-mainnet":{chainId:42170,name:"arbnova-mainnet"},"blast-mainnet":{chainId:81457,name:"blast-mainnet"},"blast-sepolia":{chainId:168587773,name:"blast-sepolia"},"mantle-mainnet":{chainId:5e3,name:"mantle-mainnet"},"mantle-sepolia":{chainId:5003,name:"mantle-sepolia"},"scroll-mainnet":{chainId:534352,name:"scroll-mainnet"},"scroll-sepolia":{chainId:534351,name:"scroll-sepolia"},"gnosis-mainnet":{chainId:100,name:"gnosis-mainnet"},"gnosis-chiado":{chainId:10200,name:"gnosis-chiado"},"bnb-mainnet":{chainId:56,name:"bnb-mainnet"},"bnb-testnet":{chainId:97,name:"bnb-testnet"},"avax-mainnet":{chainId:43114,name:"avax-mainnet"},"avax-fuji":{chainId:43113,name:"avax-fuji"},"celo-mainnet":{chainId:42220,name:"celo-mainnet"},"celo-alfajores":{chainId:44787,name:"celo-alfajores"},"metis-mainnet":{chainId:1088,name:"metis-mainnet"},"opbnb-mainnet":{chainId:204,name:"opbnb-mainnet"},"opbnb-testnet":{chainId:5611,name:"opbnb-testnet"},"berachain-bartio":{chainId:80084,name:"berachain-bartio"},"soneium-minato":{chainId:1946,name:"soneium-minato"}};function Pt(){}const rt="0x",Ct="0x0000000000000000000000000000000000000000";class wt{constructor(e){this.apiKey=(e==null?void 0:e.apiKey)||J,this.network=(e==null?void 0:e.network)||et,this.maxRetries=(e==null?void 0:e.maxRetries)||bt,this.url=e==null?void 0:e.url,this.authToken=e==null?void 0:e.authToken,this.batchRequests=(e==null?void 0:e.batchRequests)||!1,this.requestTimeout=(e==null?void 0:e.requestTimeout)||Ot,this.connectionInfoOverrides=e==null?void 0:e.connectionInfoOverrides}_getRequestUrl(e){return this.url!==void 0?this.url:e===g.NFT?Rt(this.network,this.apiKey):e===g.WEBHOOK?St():tt(this.network,this.apiKey)}getProvider(){return this._baseAlchemyProvider||(this._baseAlchemyProvider=a(this,void 0,void 0,function*(){const{AlchemyProvider:e}=yield Ie(()=>Promise.resolve().then(()=>ur),void 0);return new e(this)})),this._baseAlchemyProvider}getWebSocketProvider(){return this._baseAlchemyWssProvider||(this._baseAlchemyWssProvider=a(this,void 0,void 0,function*(){const{AlchemyWebSocketProvider:e}=yield Ie(()=>Promise.resolve().then(()=>wr),void 0);return new e(this)})),this._baseAlchemyWssProvider}}const Mt="logger/5.7.0";let Ue=!1,xe=!1;const V={debug:1,default:2,info:2,warning:3,error:4,off:5};let Ke=V.default,de=null;function Bt(){try{const t=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch{t.push(e)}}),t.length)throw new Error("missing "+t.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(t){return t.message}return null}const Ge=Bt();var me;(function(t){t.DEBUG="DEBUG",t.INFO="INFO",t.WARNING="WARNING",t.ERROR="ERROR",t.OFF="OFF"})(me||(me={}));var R;(function(t){t.UNKNOWN_ERROR="UNKNOWN_ERROR",t.NOT_IMPLEMENTED="NOT_IMPLEMENTED",t.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.TIMEOUT="TIMEOUT",t.BUFFER_OVERRUN="BUFFER_OVERRUN",t.NUMERIC_FAULT="NUMERIC_FAULT",t.MISSING_NEW="MISSING_NEW",t.INVALID_ARGUMENT="INVALID_ARGUMENT",t.MISSING_ARGUMENT="MISSING_ARGUMENT",t.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",t.CALL_EXCEPTION="CALL_EXCEPTION",t.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",t.NONCE_EXPIRED="NONCE_EXPIRED",t.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",t.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",t.TRANSACTION_REPLACED="TRANSACTION_REPLACED",t.ACTION_REJECTED="ACTION_REJECTED"})(R||(R={}));const He="0123456789abcdef";class A{constructor(e){Object.defineProperty(this,"version",{enumerable:!0,value:e,writable:!1})}_log(e,n){const r=e.toLowerCase();V[r]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!(Ke>V[r])&&console.log.apply(console,n)}debug(...e){this._log(A.levels.DEBUG,e)}info(...e){this._log(A.levels.INFO,e)}warn(...e){this._log(A.levels.WARNING,e)}makeError(e,n,r){if(xe)return this.makeError("censored error",n,{});n||(n=A.errors.UNKNOWN_ERROR),r||(r={});const i=[];Object.keys(r).forEach(u=>{const c=r[u];try{if(c instanceof Uint8Array){let h="";for(let m=0;m<c.length;m++)h+=He[c[m]>>4],h+=He[c[m]&15];i.push(u+"=Uint8Array(0x"+h+")")}else i.push(u+"="+JSON.stringify(c))}catch{i.push(u+"="+JSON.stringify(r[u].toString()))}}),i.push(`code=${n}`),i.push(`version=${this.version}`);const s=e;let o="";switch(n){case R.NUMERIC_FAULT:{o="NUMERIC_FAULT";const u=e;switch(u){case"overflow":case"underflow":case"division-by-zero":o+="-"+u;break;case"negative-power":case"negative-width":o+="-unsupported";break;case"unbound-bitwise-result":o+="-unbound-result";break}break}case R.CALL_EXCEPTION:case R.INSUFFICIENT_FUNDS:case R.MISSING_NEW:case R.NONCE_EXPIRED:case R.REPLACEMENT_UNDERPRICED:case R.TRANSACTION_REPLACED:case R.UNPREDICTABLE_GAS_LIMIT:o=n;break}o&&(e+=" [ See: https://links.ethers.org/v5-errors-"+o+" ]"),i.length&&(e+=" ("+i.join(", ")+")");const d=new Error(e);return d.reason=s,d.code=n,Object.keys(r).forEach(function(u){d[u]=r[u]}),d}throwError(e,n,r){throw this.makeError(e,n,r)}throwArgumentError(e,n,r){return this.throwError(e,A.errors.INVALID_ARGUMENT,{argument:n,value:r})}assert(e,n,r,i){e||this.throwError(n,r,i)}assertArgument(e,n,r,i){e||this.throwArgumentError(n,r,i)}checkNormalize(e){Ge&&this.throwError("platform missing String.prototype.normalize",A.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:Ge})}checkSafeUint53(e,n){typeof e=="number"&&(n==null&&(n="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(n,A.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(n,A.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,n,r){r?r=": "+r:r="",e<n&&this.throwError("missing argument"+r,A.errors.MISSING_ARGUMENT,{count:e,expectedCount:n}),e>n&&this.throwError("too many arguments"+r,A.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:n})}checkNew(e,n){(e===Object||e==null)&&this.throwError("missing new",A.errors.MISSING_NEW,{name:n.name})}checkAbstract(e,n){e===n?this.throwError("cannot instantiate abstract class "+JSON.stringify(n.name)+" directly; use a sub-class",A.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",A.errors.MISSING_NEW,{name:n.name})}static globalLogger(){return de||(de=new A(Mt)),de}static setCensorship(e,n){if(!e&&n&&this.globalLogger().throwError("cannot permanently disable censorship",A.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),Ue){if(!e)return;this.globalLogger().throwError("error censorship permanent",A.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}xe=!!e,Ue=!!n}static setLogLevel(e){const n=V[e.toLowerCase()];if(n==null){A.globalLogger().warn("invalid log level - "+e);return}Ke=n}static from(e){return new A(e)}}A.errors=R;A.levels=me;const Ft="properties/5.7.0";var Lt=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function d(h){try{c(r.next(h))}catch(m){o(m)}}function u(h){try{c(r.throw(h))}catch(m){o(m)}}function c(h){h.done?s(h.value):i(h.value).then(d,u)}c((r=r.apply(t,e||[])).next())})};const it=new A(Ft);function Dt(t,e,n){Object.defineProperty(t,e,{enumerable:!0,value:n,writable:!1})}function st(t){return Lt(this,void 0,void 0,function*(){const e=Object.keys(t).map(r=>{const i=t[r];return Promise.resolve(i).then(s=>({key:r,value:s}))});return(yield Promise.all(e)).reduce((r,i)=>(r[i.key]=i.value,r),{})})}const Ut={bigint:!0,boolean:!0,function:!0,number:!0,string:!0};function ot(t){if(t==null||Ut[typeof t])return!0;if(Array.isArray(t)||typeof t=="object"){if(!Object.isFrozen(t))return!1;const e=Object.keys(t);for(let n=0;n<e.length;n++){let r=null;try{r=t[e[n]]}catch{continue}if(!ot(r))return!1}return!0}return it.throwArgumentError(`Cannot deepCopy ${typeof t}`,"object",t)}function xt(t){if(ot(t))return t;if(Array.isArray(t))return Object.freeze(t.map(e=>ve(e)));if(typeof t=="object"){const e={};for(const n in t){const r=t[n];r!==void 0&&Dt(e,n,ve(r))}return e}return it.throwArgumentError(`Cannot deepCopy ${typeof t}`,"object",t)}function ve(t){return xt(t)}function _(t){return N.from(t).toNumber()}function B(t){return N.from(t).toHexString()}function je(t){return typeof t=="string"?t:Number.isInteger(t)?B(t):t.toString()}function at(t,e){return Object.values(e).includes(t)?t:null}function Kt(t){return y(Object.assign(Object.assign({},j(t)),{spamClassifications:t.spamClassifications.map(Vt)}))}function Gt(t){return y(Object.assign(Object.assign({},j(t)),{displayNft:t.displayNft,image:t.image,totalBalance:t.totalBalance,numDistinctTokensOwned:t.numDistinctTokensOwned,isSpam:t.isSpam}))}function j(t){var e;return y(Object.assign(Object.assign({},t),{tokenType:ct(t.tokenType),openSeaMetadata:Object.assign(Object.assign({},t.openSeaMetadata),{safelistRequestStatus:!((e=t.openSeaMetadata)===null||e===void 0)&&e.safelistRequestStatus?at(t.openSeaMetadata.safelistRequestStatus,he):null})}))}function Ht(t){return y(Object.assign(Object.assign({},t),{floorPrice:Object.assign(Object.assign({},t.floorPrice),{marketplace:zt(t.floorPrice.marketplace)})}))}function re(t,e){return{contractAddress:e||t.contractAddress,tokenId:t.tokenId}}function U(t){return y(Object.assign(Object.assign({},t),{contract:Kt(t.contract),tokenType:ct(t.tokenType),acquiredAt:t.acquiredAt,collection:t.collection,mint:t.mint}))}function jt(t){return y({nftSales:t.nftSales.map(e=>Object.assign(Object.assign({},e),{marketplace:Wt(e.marketplace),taker:qt(e.taker)})),validAt:t.validAt,pageKey:t.pageKey})}function Wt(t){switch(t){case"looksrare":return P.LOOKSRARE;case"seaport":return P.SEAPORT;case"x2y2":return P.X2Y2;case"wyvern":return P.WYVERN;case"cryptopunks":return P.CRYPTOPUNKS;case"blur":return P.BLUR;default:return P.UNKNOWN}}function zt(t){switch(t){case"OpenSea":return fe.OPENSEA;default:return}}function qt(t){switch(t.toLowerCase()){case"buyer":return Q.BUYER;case"seller":return Q.SELLER;default:throw new Error(`Unsupported NftSaleTakerType ${t}`)}}function Vt(t){const e=at(t,Z);return e??Z.Unknown}function ct(t){switch(t){case"erc721":case"ERC721":return I.ERC721;case"erc1155":case"ERC1155":return I.ERC1155;case"no_supported_nft_standard":case"NO_SUPPORTED_NFT_STANDARD":return I.NO_SUPPORTED_NFT_STANDARD;case"not_a_contract":case"NOT_A_CONTRACT":return I.NOT_A_CONTRACT;default:return I.UNKNOWN}}const dt=typeof window<"u"&&window!==null;function y(t){if(t!=null){if(t.constructor.name==="Object"||Array.isArray(t))for(const e in t)t[e]=y(t[e]);return t}}function ie(t,e,n="getAssetTransfers"){return a(this,void 0,void 0,function*(){const r=yield t.getProvider();return e.fromAddress&&(e.fromAddress=yield r._getAddress(e.fromAddress)),e.toAddress&&(e.toAddress=yield r._getAddress(e.toAddress)),r._send("alchemy_getAssetTransfers",[Object.assign(Object.assign({},e),{fromBlock:e.fromBlock!=null?je(e.fromBlock):void 0,toBlock:e.toBlock!=null?je(e.toBlock):void 0,maxCount:e.maxCount!=null?B(e.maxCount):void 0})],n)})}function We(t,e,n="getTransactionReceipts"){return a(this,void 0,void 0,function*(){return(yield t.getProvider())._send("alchemy_getTransactionReceipts",[e],n)})}function Yt(t,e){return a(this,void 0,void 0,function*(){const n=yield t.getProvider();yield n.getNetwork();const r=yield st({filter:$t(t,e)}),i=yield n.send("eth_getLogs",[r.filter]);return i.forEach(s=>{s.removed==null&&(s.removed=!1)}),Xt(n.formatter.filterLog.bind(n.formatter))(i)})}function $t(t,e){return a(this,void 0,void 0,function*(){const n=yield t.getProvider(),r=yield e;let i={};return["blockHash","topics"].forEach(s=>{r[s]!=null&&(i[s]=r[s])}),["fromBlock","toBlock"].forEach(s=>{r[s]!=null&&(i[s]=n._getBlockTag(r[s]))}),i=n.formatter.filter(yield st(i)),Array.isArray(r.address)?i.address=yield Promise.all(r.address.map(s=>a(this,void 0,void 0,function*(){return n._getAddress(s)}))):r.address!=null&&(i.address=yield n._getAddress(r.address)),i})}function Xt(t){return function(e){if(!Array.isArray(e))throw new Error("not an array");const n=[];return e.forEach(r=>{n.push(t(r))}),n}}class Zt{constructor(e){this.config=e}getBalance(e,n){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getBalance(e,n)})}isContractAddress(e){return a(this,void 0,void 0,function*(){return(yield(yield this.config.getProvider()).getCode(e))!=="0x"})}getCode(e,n){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getCode(e,n)})}getStorageAt(e,n,r){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getStorageAt(e,n,r)})}getTransactionCount(e,n){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getTransactionCount(e,n)})}getBlock(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getBlock(e)})}getBlockWithTransactions(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getBlockWithTransactions(e)})}getNetwork(){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getNetwork()})}getBlockNumber(){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getBlockNumber()})}getGasPrice(){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getGasPrice()})}getFeeData(){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getFeeData()})}ready(){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).ready})}call(e,n){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).call(e,n)})}estimateGas(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).estimateGas(e)})}getTransaction(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getTransaction(e)})}getTransactionReceipt(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getTransactionReceipt(e)})}sendTransaction(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).sendTransaction(e)})}waitForTransaction(e,n,r){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).waitForTransaction(e,n,r)})}getLogs(e){return a(this,void 0,void 0,function*(){return Yt(this.config,e)})}send(e,n){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).send(e,n)})}findContractDeployer(e){var n;return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider(),i=yield r.getBlockNumber();if((yield r.getCode(e,i))===rt)throw new Error(`Contract '${e}' does not exist`);const s=yield ge(0,i+1,e,this.config),d=(n=(yield We(this.config,{blockNumber:B(s)},"findContractDeployer")).receipts)===null||n===void 0?void 0:n.find(u=>u.contractAddress===e.toLowerCase());return{deployerAddress:d==null?void 0:d.from,blockNumber:s}})}getTokenBalances(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider(),i=yield r._getAddress(e);if(Array.isArray(n)){if(n.length>1500)throw new Error("You cannot pass in more than 1500 contract addresses to getTokenBalances()");if(n.length===0)throw new Error("getTokenBalances() requires at least one contractAddress when using an array");return r._send("alchemy_getTokenBalances",[i,n],"getTokenBalances")}else{const s=n===void 0?H.ERC20:n.type,o=[i,s];return(n==null?void 0:n.type)===H.ERC20&&n.pageKey&&o.push({pageKey:n.pageKey}),r._send("alchemy_getTokenBalances",o,"getTokenBalances")}})}getTokensForOwner(e,n){var r;return a(this,void 0,void 0,function*(){const i=yield this.config.getProvider(),o=[yield i._getAddress(e),(r=n==null?void 0:n.contractAddresses)!==null&&r!==void 0?r:H.ERC20];n!=null&&n.pageKey&&o.push({pageKey:n.pageKey});const d=yield i._send("alchemy_getTokenBalances",o,"getTokensForOwner"),u=d.tokenBalances.map(f=>({contractAddress:f.contractAddress,rawBalance:N.from(f.tokenBalance).toString()})),h=(yield Promise.allSettled(d.tokenBalances.map(f=>i._send("alchemy_getTokenMetadata",[f.contractAddress],"getTokensForOwner",!0)))).map(f=>f.status==="fulfilled"?f.value:{name:null,symbol:null,decimals:null,logo:null});return{tokens:u.map((f,v)=>Object.assign(Object.assign(Object.assign({},f),h[v]),{balance:h[v].decimals!==null?At(f.rawBalance,h[v].decimals):void 0})).map(f=>y(f)),pageKey:d.pageKey}})}getTokenMetadata(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider())._send("alchemy_getTokenMetadata",[e],"getTokenMetadata")})}getAssetTransfers(e){return a(this,void 0,void 0,function*(){return ie(this.config,e)})}getTransactionReceipts(e){return a(this,void 0,void 0,function*(){return We(this.config,e)})}resolveName(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).resolveName(e)})}lookupAddress(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).lookupAddress(e)})}}function ge(t,e,n,r){return a(this,void 0,void 0,function*(){if(t>=e)return e;const i=Math.floor((t+e)/2);return(yield(yield r.getProvider()).getCode(n,i))===rt?ge(i+1,e,n,r):ge(t,i,n,r)})}class Qt{constructor(e){this.config=e}traceCall(e,n,r){return a(this,void 0,void 0,function*(){const i=yield this.config.getProvider(),s=[e,n,W(r)];return i._send("debug_traceCall",s,"traceCall")})}traceTransaction(e,n,r){return a(this,void 0,void 0,function*(){const i=yield this.config.getProvider(),s=[e,W(n,r)];return i._send("debug_traceTransaction",s,"traceTransaction")})}traceBlock(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider();let i,s;return yt(e,32)?(i="debug_traceBlockByHash",s=[e,W(n)]):(i="debug_traceBlockByNumber",s=[typeof e=="number"?Tt(_t(e)):e,W(n)]),r._send(i,s,"traceBlock")})}}function W(t,e){return Object.assign({tracer:t.type},t.onlyTopCall!==void 0&&{tracerConfig:{onlyTopCall:t.onlyTopCall,timeout:e}})}function Jt(t){if(t===I.ERC1155||t===I.ERC721)return t}var T;(function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t[t.SILENT=4]="SILENT"})(T||(T={}));T.DEBUG,T.INFO,T.WARN,T.ERROR,T.SILENT;const en={[T.DEBUG]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},tn=T.INFO;function lt(t,...e){_e.debug(t,e)}function ze(t,...e){_e.info(t,e)}function nn(t,...e){_e.warn(t,e)}class rn{constructor(){this._logLevel=tn}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in T))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}debug(...e){this._log(T.DEBUG,...e)}info(...e){this._log(T.INFO,...e)}warn(...e){this._log(T.WARN,...e)}error(...e){this._log(T.ERROR,...e)}_log(e,...n){if(e<this._logLevel)return;const r=new Date().toISOString(),i=en[e];if(i)console[i](`[${r}] Alchemy:`,...n.map(sn));else throw new Error(`Logger received an invalid logLevel (value: ${e})`)}}function sn(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return t}}const _e=new rn,te="3.4.3";function on(t,e,n,r,i){var s;const o=t+"/"+e,d=Object.assign(Object.assign({},i),{headers:Object.assign(Object.assign(Object.assign({},i==null?void 0:i.headers),!dt&&{"Accept-Encoding":"gzip"}),{"Alchemy-Ethers-Sdk-Version":te,"Alchemy-Ethers-Sdk-Method":n}),method:(s=i==null?void 0:i.method)!==null&&s!==void 0?s:"GET",url:o,params:r});return Ze(d)}const an=1e3,cn=1.5,dn=30*1e3,ln=5;class un{constructor(e=ln){this.maxAttempts=e,this.initialDelayMs=an,this.backoffMultiplier=cn,this.maxDelayMs=dn,this.numAttempts=0,this.currentDelayMs=0,this.isInBackoff=!1}backoff(){if(this.numAttempts>=this.maxAttempts)return Promise.reject(new Error(`Exceeded maximum number of attempts: ${this.maxAttempts}`));if(this.isInBackoff)return Promise.reject(new Error("A backoff operation is already in progress"));const e=this.withJitterMs(this.currentDelayMs);return e>0&&lt("ExponentialBackoff.backoff",`Backing off for ${e}ms`),this.currentDelayMs*=this.backoffMultiplier,this.currentDelayMs=Math.max(this.currentDelayMs,this.initialDelayMs),this.currentDelayMs=Math.min(this.currentDelayMs,this.maxDelayMs),this.numAttempts+=1,new Promise(n=>{this.isInBackoff=!0,setTimeout(()=>{this.isInBackoff=!1,n()},e)})}withJitterMs(e){return Math.min(e+(Math.random()-.5)*e,this.maxDelayMs)}}function E(t,e,n,r,i,s){return a(this,void 0,void 0,function*(){let o;const d=new un(t.maxRetries);for(let u=0;u<t.maxRetries+1;u++)try{o!==void 0&&ze("requestHttp",`Retrying after error: ${o.message}`);try{yield d.backoff()}catch{break}const c=yield on(t._getRequestUrl(e),n,r,i,Object.assign(Object.assign({},s),{timeout:t.requestTimeout}));if(c.status===200)return lt(n,`Successful request: ${n}`),c.data;ze(n,`Request failed: ${n}, ${c.status}, ${c.data}`),o=new Error(c.status+": "+c.data)}catch(c){if(!Ze.isAxiosError(c)||c.response===void 0)throw c;if(o=new Error(c.response.status+": "+JSON.stringify(c.response.data)),!hn(c,e))break}return Promise.reject(o)})}function hn(t,e){const n=e===g.WEBHOOK?[429,500]:[429];return t.response!==void 0&&n.includes(t.response.status)}function ut(t,e,n,r,i,s,o){return Te(this,arguments,function*(){let u=!0;const c=Object.assign({},o);for(;u;){const h=yield k(E(t,e,n,r,c));yield yield k(h),h[s]!==null?c[i]=h[s]:u=!1}})}function ht(t,e,n,r,i="getNftMetadata"){return a(this,void 0,void 0,function*(){const s=yield E(t,g.NFT,"getNFTMetadata",i,{contractAddress:e,tokenId:N.from(n).toString(),tokenType:Jt(r==null?void 0:r.tokenType),tokenUriTimeoutInMs:r==null?void 0:r.tokenUriTimeoutInMs,refreshCache:r==null?void 0:r.refreshCache});return U(s)})}function ft(t,e,n){return a(this,void 0,void 0,function*(){const r={tokens:e,tokenUriTimeoutInMs:n==null?void 0:n.tokenUriTimeoutInMs,refreshCache:n==null?void 0:n.refreshCache};return{nfts:(yield E(t,g.NFT,"getNFTMetadataBatch","getNftMetadataBatch",{},{method:"POST",data:r})).nfts.map(s=>U(s))}})}function fn(t,e,n="getContractMetadata"){return a(this,void 0,void 0,function*(){const r=yield E(t,g.NFT,"getContractMetadata",n,{contractAddress:e});return j(r)})}function mn(t,e){return a(this,void 0,void 0,function*(){return{contracts:(yield E(t,g.NFT,"getContractMetadataBatch","getContractMetadataBatch",{},{method:"POST",data:{contractAddresses:e}})).contracts.map(j)}})}function vn(t,e,n="getCollectionMetadata"){return a(this,void 0,void 0,function*(){const r=yield E(t,g.NFT,"getCollectionMetadata",n,{collectionSlug:e});return Ht(r)})}function gn(t,e,n,r="getNftsForOwnerIterator"){return Te(this,arguments,function*(){var s,o;const d=se(n==null?void 0:n.omitMetadata);try{for(var u=Je(ut(t,g.NFT,"getNFTsForOwner",r,"pageKey","pageKey",{contractAddresses:n==null?void 0:n.contractAddresses,pageKey:n==null?void 0:n.pageKey,excludeFilters:n==null?void 0:n.excludeFilters,includeFilters:n==null?void 0:n.includeFilters,owner:e,withMetadata:d,tokenUriTimeoutInMs:n==null?void 0:n.tokenUriTimeoutInMs,orderBy:n==null?void 0:n.orderBy})),c;c=yield k(u.next()),!c.done;){const h=c.value;for(const m of h.ownedNfts)yield yield k(Object.assign(Object.assign({},xn(m)),{balance:m.balance}))}}catch(h){s={error:h}}finally{try{c&&!c.done&&(o=u.return)&&(yield k(o.call(u)))}finally{if(s)throw s.error}}})}function Ee(t,e,n,r="getNftsForOwner"){return a(this,void 0,void 0,function*(){const i=se(n==null?void 0:n.omitMetadata),s=yield E(t,g.NFT,"getNFTsForOwner",r,{contractAddresses:n==null?void 0:n.contractAddresses,pageKey:n==null?void 0:n.pageKey,excludeFilters:n==null?void 0:n.excludeFilters,includeFilters:n==null?void 0:n.includeFilters,owner:e,pageSize:n==null?void 0:n.pageSize,withMetadata:i,tokenUriTimeoutInMs:n==null?void 0:n.tokenUriTimeoutInMs,orderBy:n==null?void 0:n.orderBy});return y(i?{ownedNfts:s.ownedNfts.map(o=>Object.assign(Object.assign({},U(o)),{balance:o.balance})),pageKey:s.pageKey,totalCount:s.totalCount,validAt:s.validAt}:{ownedNfts:s.ownedNfts.map(o=>Object.assign(Object.assign({},re(o)),{balance:o.balance})),pageKey:s.pageKey,totalCount:s.totalCount,validAt:s.validAt})})}function En(t,e,n,r="getNftsForContract"){var i;return a(this,void 0,void 0,function*(){const s=se(n==null?void 0:n.omitMetadata),o=yield E(t,g.NFT,"getNFTsForContract",r,{contractAddress:e,pageKey:n==null?void 0:n.pageKey,withMetadata:s,limit:(i=n==null?void 0:n.pageSize)!==null&&i!==void 0?i:void 0,tokenUriTimeoutInMs:n==null?void 0:n.tokenUriTimeoutInMs});return y(s?{nfts:o.nfts.map(d=>U(d)),pageKey:o.pageKey}:{nfts:o.nfts.map(d=>re(d,e)),pageKey:o.pageKey})})}function An(t,e,n,r="getNftsForContractIterator"){return Te(this,arguments,function*(){var s,o;const d=se(n==null?void 0:n.omitMetadata);try{for(var u=Je(ut(t,g.NFT,"getNFTsForContract",r,"pageKey","pageKey",{contractAddress:e,pageKey:n==null?void 0:n.pageKey,withMetadata:d})),c;c=yield k(u.next()),!c.done;){const h=c.value;for(const m of h.nfts)yield yield k(Kn(m,e))}}catch(h){s={error:h}}finally{try{c&&!c.done&&(o=u.return)&&(yield k(o.call(u)))}finally{if(s)throw s.error}}})}function yn(t,e,n,r="getOwnersForContract"){return a(this,void 0,void 0,function*(){const i=yield E(t,g.NFT,"getOwnersForContract",r,Object.assign(Object.assign({},n),{contractAddress:e}));return n!=null&&n.withTokenBalances?y({owners:i.owners,pageKey:i.pageKey}):y({owners:i.owners,pageKey:i.pageKey})})}function Tn(t,e,n,r="getContractsForOwner"){return a(this,void 0,void 0,function*(){const i=yield E(t,g.NFT,"getContractsForOwner",r,{owner:e,excludeFilters:n==null?void 0:n.excludeFilters,includeFilters:n==null?void 0:n.includeFilters,pageKey:n==null?void 0:n.pageKey,pageSize:n==null?void 0:n.pageSize,orderBy:n==null?void 0:n.orderBy});return y({contracts:i.contracts.map(Gt),pageKey:i.pageKey,totalCount:i.totalCount})})}function _n(t,e,n,r,i="getOwnersForNft"){return a(this,void 0,void 0,function*(){return E(t,g.NFT,"getOwnersForNFT",i,Object.assign({contractAddress:e,tokenId:N.from(n).toString()},r))})}function Nn(t,e,n){return a(this,void 0,void 0,function*(){const i=yield(yield t.getProvider())._getAddress(e),s=mt(n==null?void 0:n.tokenType),o={fromBlock:"0x0",fromAddress:Ct,toAddress:i,excludeZeroValue:!0,contractAddresses:n==null?void 0:n.contractAddresses,category:s,maxCount:100,pageKey:n==null?void 0:n.pageKey},d=yield ie(t,o,"getMintedNfts");return Ne(t,d)})}function pn(t,e,n,r){return a(this,void 0,void 0,function*(){const s=yield(yield t.getProvider())._getAddress(e),o=mt(r==null?void 0:r.tokenType),d={fromBlock:"0x0",excludeZeroValue:!0,contractAddresses:r==null?void 0:r.contractAddresses,category:o,maxCount:100,pageKey:r==null?void 0:r.pageKey};n===ue.TO?d.toAddress=s:d.fromAddress=s;const u=yield ie(t,d,"getTransfersForOwner");return Ne(t,u)})}function In(t,e,n){return a(this,void 0,void 0,function*(){const r=[b.ERC721,b.ERC1155,b.SPECIALNFT],i=yield t.getProvider(),s=n!=null&&n.fromBlock?i.formatter.blockTag(yield i._getBlockTag(n.fromBlock)):"0x0",o=n!=null&&n.toBlock?i.formatter.blockTag(yield i._getBlockTag(n.toBlock)):void 0,d={fromBlock:s,toBlock:o,excludeZeroValue:!0,contractAddresses:[e],order:n==null?void 0:n.order,category:r,maxCount:100,pageKey:n==null?void 0:n.pageKey},u=yield ie(t,d,"getTransfersForContract");return Ne(t,u)})}function mt(t){switch(t){case I.ERC721:return[b.ERC721];case I.ERC1155:return[b.ERC1155];default:return[b.ERC721,b.ERC1155,b.SPECIALNFT]}}function bn(t){return t.erc1155Metadata.map(e=>({contractAddress:t.rawContract.address,tokenId:e.tokenId,tokenType:I.ERC1155}))}function On(t,e,n,r="verifyNftOwnership"){return a(this,void 0,void 0,function*(){if(typeof n=="string")return(yield Ee(t,e,{contractAddresses:[n],omitMetadata:!0},r)).ownedNfts.length>0;{if(n.length===0)throw new Error("Must provide at least one contract address");const i=yield Ee(t,e,{contractAddresses:n,omitMetadata:!0},r),s=n.reduce((o,d)=>(o[d]=!1,o),{});for(const o of i.ownedNfts)s[o.contractAddress]=!0;return s}})}function Rn(t,e,n="isSpamContract"){return a(this,void 0,void 0,function*(){return E(t,g.NFT,"isSpamContract",n,{contractAddress:e})})}function kn(t,e="getSpamContracts"){return a(this,void 0,void 0,function*(){return E(t,g.NFT,"getSpamContracts",e,void 0)})}function Sn(t,e,n="reportSpam"){return a(this,void 0,void 0,function*(){E(t,g.NFT,"reportSpam",n,{contractAddress:e})})}function Pn(t,e,n,r="isAirdropNft"){return a(this,void 0,void 0,function*(){return E(t,g.NFT,"isAirdropNFT",r,{contractAddress:e,tokenId:n})})}function Cn(t,e,n="getFloorPrice"){return a(this,void 0,void 0,function*(){const r=yield E(t,g.NFT,"getFloorPrice",n,{contractAddress:e});return y(r)})}function wn(t,e={},n="getNftSales"){return a(this,void 0,void 0,function*(){const r=Object.assign({},e),i=yield E(t,g.NFT,"getNFTSales",n,{fromBlock:r==null?void 0:r.fromBlock,toBlock:r==null?void 0:r.toBlock,order:r==null?void 0:r.order,marketplace:r==null?void 0:r.marketplace,contractAddress:r==null?void 0:r.contractAddress,tokenId:r!=null&&r.tokenId?N.from(r==null?void 0:r.tokenId).toString():void 0,sellerAddress:r==null?void 0:r.sellerAddress,buyerAddress:r==null?void 0:r.buyerAddress,taker:r==null?void 0:r.taker,limit:r==null?void 0:r.limit,pageKey:r==null?void 0:r.pageKey});return jt(i)})}function Mn(t,e,n,r="computeRarity"){return a(this,void 0,void 0,function*(){const i=yield E(t,g.NFT,"computeRarity",r,{contractAddress:e,tokenId:N.from(n).toString()});return y(i)})}function Bn(t,e,n="searchContractMetadata"){return a(this,void 0,void 0,function*(){return{contracts:(yield E(t,g.NFT,"searchContractMetadata",n,{query:e})).contracts.map(j)}})}function Fn(t,e,n="summarizeNftAttributes"){return a(this,void 0,void 0,function*(){return E(t,g.NFT,"summarizeNFTAttributes",n,{contractAddress:e})})}function Ln(t,e,n,r="refreshNftMetadata"){return a(this,void 0,void 0,function*(){const i=N.from(n).toString(),s=yield ht(t,e,i,void 0,r),o=yield Un(t,e,i,r);return s.timeLastUpdated!==o.timeLastUpdated})}function Dn(t,e,n="refreshContract"){return a(this,void 0,void 0,function*(){const r=yield E(t,g.NFT,"reingestContract",n,{contractAddress:e});return{contractAddress:r.contractAddress,refreshState:Hn(r.reingestionState),progress:r.progress}})}function Un(t,e,n,r){return a(this,void 0,void 0,function*(){const i=yield E(t,g.NFT,"getNFTMetadata",r,{contractAddress:e,tokenId:N.from(n).toString(),refreshCache:!0});return U(i)})}function xn(t){return vt(t)?U(t):re(t)}function Kn(t,e){return vt(t)?U(t):re(t,e)}function vt(t){return t.name!==void 0}function Ne(t,e){return a(this,void 0,void 0,function*(){const n=e.transfers.filter(c=>c.rawContract.address!==null).flatMap(c=>{var h;const m=Gn(c),f={from:c.from,to:(h=c.to)!==null&&h!==void 0?h:void 0,transactionHash:c.hash,blockNumber:c.blockNum};return m.map(v=>({metadata:f,token:v}))});if(n.length===0)return{nfts:[]};const r=100,i=[];for(let c=0;c<n.length;c+=r)i.push(n.slice(c,c+r));const o=(yield Promise.all(i.map(c=>ft(t,c.map(h=>h.token))))).map(c=>c.nfts).flat(),d=new Map;return o.forEach(c=>{const h=`${c.contract.address.toLowerCase()}-${N.from(c.tokenId).toString()}`;d.set(h,c)}),{nfts:n.map(c=>{const h=`${c.token.contractAddress.toLowerCase()}-${N.from(c.token.tokenId).toString()}`;return Object.assign(Object.assign({},d.get(h)),c.metadata)}),pageKey:e.pageKey}})}function Gn(t){return t.category===b.ERC1155?bn(t):[{contractAddress:t.rawContract.address,tokenId:t.tokenId,tokenType:t.category===b.ERC721?I.ERC721:void 0}]}function se(t){return t===void 0?!0:!t}function Hn(t){switch(t){case"does_not_exist":return w.DOES_NOT_EXIST;case"already_queued":return w.ALREADY_QUEUED;case"in_progress":return w.IN_PROGRESS;case"finished":return w.FINISHED;case"queued":return w.QUEUED;case"queue_failed":return w.QUEUE_FAILED;default:throw new Error("Unknown reingestion state: "+t)}}class jn{constructor(e){this.config=e}getNftMetadata(e,n,r,i){let s;return typeof r=="object"?s={tokenType:r.tokenType,tokenUriTimeoutInMs:r.tokenUriTimeoutInMs,refreshCache:r.refreshCache}:s={tokenType:r,tokenUriTimeoutInMs:i},ht(this.config,e,n,s)}getNftMetadataBatch(e,n){return ft(this.config,e,n)}getContractMetadata(e){return fn(this.config,e)}getContractMetadataBatch(e){return mn(this.config,e)}getCollectionMetadata(e){return vn(this.config,e)}getNftsForOwnerIterator(e,n){return gn(this.config,e,n)}getNftsForOwner(e,n){return Ee(this.config,e,n)}getNftsForContract(e,n){return En(this.config,e,n)}getNftsForContractIterator(e,n){return An(this.config,e,n)}getOwnersForContract(e,n){return yn(this.config,e,n)}getOwnersForNft(e,n,r){return _n(this.config,e,n,r)}getContractsForOwner(e,n){return Tn(this.config,e,n)}getTransfersForOwner(e,n,r){return pn(this.config,e,n,r)}getTransfersForContract(e,n){return In(this.config,e,n)}getMintedNfts(e,n){return a(this,void 0,void 0,function*(){return Nn(this.config,e,n)})}verifyNftOwnership(e,n){return On(this.config,e,n)}isSpamContract(e){return Rn(this.config,e)}getSpamContracts(){return kn(this.config)}reportSpam(e){return Sn(this.config,e)}isAirdropNft(e,n){return Pn(this.config,e,n)}getFloorPrice(e){return Cn(this.config,e)}getNftSales(e){return wn(this.config,e)}computeRarity(e,n){return Mn(this.config,e,n)}searchContractMetadata(e){return Bn(this.config,e)}summarizeNftAttributes(e){return Fn(this.config,e)}refreshNftMetadata(e,n){return Ln(this.config,e,n)}refreshContract(e){return Dn(this.config,e)}}class Wn{constructor(e){this.config=e}getAllWebhooks(){return a(this,void 0,void 0,function*(){this.verifyConfig();const e=yield this.sendWebhookRequest("team-webhooks","getAllWebhooks",{});return{webhooks:zn(e),totalCount:e.data.length}})}getAddresses(e,n){return a(this,void 0,void 0,function*(){this.verifyConfig();const r=typeof e=="string"?e:e.id,i=yield this.sendWebhookRequest("webhook-addresses","getAddresses",{webhook_id:r,limit:n==null?void 0:n.limit,after:n==null?void 0:n.pageKey});return qn(i)})}getGraphqlQuery(e){return a(this,void 0,void 0,function*(){this.verifyConfig();const n=typeof e=="string"?e:e.id,r=yield this.sendWebhookRequest("dashboard-webhook-graphql-query","getGraphqlQuery",{webhook_id:n});return Vn(r)})}getNftFilters(e,n){return a(this,void 0,void 0,function*(){this.verifyConfig();const r=typeof e=="string"?e:e.id,i=yield this.sendWebhookRequest("webhook-nft-filters","getNftFilters",{webhook_id:r,limit:n==null?void 0:n.limit,after:n==null?void 0:n.pageKey});return Yn(i)})}updateWebhook(e,n){return a(this,void 0,void 0,function*(){const r=typeof e=="string"?e:e.id;let i,s,o,d;if("isActive"in n)i="update-webhook",s="updateWebhook",o="PUT",d={webhook_id:r,is_active:n.isActive};else if("addFilters"in n||"removeFilters"in n)i="update-webhook-nft-filters",s="updateWebhookNftFilters",o="PATCH",d={webhook_id:r,nft_filters_to_add:n.addFilters?n.addFilters.map(q):[],nft_filters_to_remove:n.removeFilters?n.removeFilters.map(q):[]};else if("addMetadataFilters"in n||"removeMetadataFilters"in n)i="update-webhook-nft-metadata-filters",s="updateWebhookNftMetadataFilters",o="PATCH",d={webhook_id:r,nft_metadata_filters_to_add:n.addMetadataFilters?n.addMetadataFilters.map(q):[],nft_metadata_filters_to_remove:n.removeMetadataFilters?n.removeMetadataFilters.map(q):[]};else if("addAddresses"in n||"removeAddresses"in n)i="update-webhook-addresses",s="webhook:updateWebhookAddresses",o="PATCH",d={webhook_id:r,addresses_to_add:yield this.resolveAddresses(n.addAddresses),addresses_to_remove:yield this.resolveAddresses(n.removeAddresses)};else if("newAddresses"in n)i="update-webhook-addresses",s="webhook:updateWebhookAddress",o="PUT",d={webhook_id:r,addresses:yield this.resolveAddresses(n.newAddresses)};else throw new Error("Invalid `update` param passed into `updateWebhook`");yield this.sendWebhookRequest(i,s,{},{method:o,data:d})})}createWebhook(e,n,r){return a(this,void 0,void 0,function*(){let i;if(n===S.MINED_TRANSACTION||n===S.DROPPED_TRANSACTION||n===S.GRAPHQL){if(!("appId"in r))throw new Error("Transaction and GraphQL Webhooks require an app id.");i=r.appId}let s=z.get(this.config.network),o,d,u,c;if(n===S.NFT_ACTIVITY||n===S.NFT_METADATA_UPDATE){if(!("filters"in r)||r.filters.length===0)throw new Error("Nft Activity Webhooks require a non-empty array input.");s=r.network?z.get(r.network):s;const f=r.filters.map(v=>v.tokenId?{contract_address:v.contractAddress,token_id:N.from(v.tokenId).toString()}:{contract_address:v.contractAddress});o=n===S.NFT_ACTIVITY?{nft_filters:f}:{nft_metadata_filters:f}}else if(n===S.ADDRESS_ACTIVITY){if(r===void 0||!("addresses"in r)||r.addresses.length===0)throw new Error("Address Activity Webhooks require a non-empty array input.");s=r.network?z.get(r.network):s,d=yield this.resolveAddresses(r.addresses)}else if(n==S.GRAPHQL){if(r===void 0||!("graphqlQuery"in r)||r.graphqlQuery.length===0)throw new Error("Custom Webhooks require a non-empty graphql query.");s=r.network?z.get(r.network):s,u=r.graphqlQuery,c=r.skipEmptyMessages}const h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({network:s,webhook_type:n,webhook_url:e},i&&{app_id:i}),o),d&&{addresses:d}),u&&{graphql_query:u}),c&&{skip_empty_messages:c}),m=yield this.sendWebhookRequest("create-webhook","createWebhook",{},{method:"POST",data:h});return gt(m.data)})}deleteWebhook(e){return a(this,void 0,void 0,function*(){this.verifyConfig();const n=typeof e=="string"?e:e.id;if("message"in(yield this.sendWebhookRequest("delete-webhook","deleteWebhook",{webhook_id:n},{method:"DELETE"})))throw new Error(`Webhook not found. Failed to delete webhook: ${n}`)})}verifyConfig(){if(this.config.authToken===void 0)throw new Error("Using the Notify API requires setting the Alchemy Auth Token in the settings object when initializing Alchemy.")}sendWebhookRequest(e,n,r,i){return E(this.config,g.WEBHOOK,e,n,r,Object.assign(Object.assign({},i),{headers:Object.assign({"X-Alchemy-Token":this.config.authToken},i==null?void 0:i.headers)}))}resolveAddresses(e){return a(this,void 0,void 0,function*(){if(e===void 0)return[];const n=[],r=yield this.config.getProvider();for(const i of e){const s=yield r.resolveName(i);if(s===null)throw new Error(`Unable to resolve the ENS address: ${i}`);n.push(s)}return n})}}const Ae={ETH_MAINNET:l.ETH_MAINNET,ETH_GOERLI:l.ETH_GOERLI,ETH_SEPOLIA:l.ETH_SEPOLIA,MATIC_MAINNET:l.MATIC_MAINNET,MATIC_MUMBAI:l.MATIC_MUMBAI,MATIC_AMOY:l.MATIC_AMOY,ARB_MAINNET:l.ARB_MAINNET,ARB_GOERLI:l.ARB_GOERLI,ARB_SEPOLIA:l.ARB_SEPOLIA,OPT_MAINNET:l.OPT_MAINNET,OPT_GOERLI:l.OPT_GOERLI,OPT_SEPOLIA:l.OPT_SEPOLIA,BASE_MAINNET:l.BASE_MAINNET,BASE_GOERLI:l.BASE_GOERLI,BASE_SEPOLIA:l.BASE_SEPOLIA,ZKSYNC_MAINNET:l.ZKSYNC_MAINNET,ZKSYNC_SEPOLIA:l.ZKSYNC_SEPOLIA},z=Object.keys(l).reduce((t,e)=>(e in Ae&&t.set(Ae[e],e),t),new Map);function zn(t){return t.data.map(gt)}function gt(t){return Object.assign({id:t.id,network:Ae[t.network],type:t.webhook_type,url:t.webhook_url,isActive:t.is_active,timeCreated:new Date(t.time_created).toISOString(),signingKey:t.signing_key,version:t.version},t.app_id!==void 0&&{appId:t.app_id})}function qn(t){return{addresses:t.data,totalCount:t.pagination.total_count,pageKey:t.pagination.cursors.after}}function Vn(t){return{graphqlQuery:t.data.graphql_query}}function Yn(t){return{filters:t.data.map(e=>e.token_id?{contractAddress:e.contract_address,tokenId:N.from(e.token_id).toString()}:{contractAddress:e.contract_address}),totalCount:t.pagination.total_count,pageKey:t.pagination.cursors.after}}function q(t){return t.tokenId?{contract_address:t.contractAddress,token_id:N.from(t.tokenId).toString()}:{contract_address:t.contractAddress}}const $n=[.9,1,1.1,1.2,1.3];class Xn{constructor(e){this.config=e}sendPrivateTransaction(e,n,r){return a(this,void 0,void 0,function*(){const i=yield this.config.getProvider(),s=n?B(n):void 0;return i._send("eth_sendPrivateTransaction",[{tx:e,maxBlockNumber:s,preferences:r}],"sendPrivateTransaction")})}cancelPrivateTransaction(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider())._send("eth_cancelPrivateTransaction",[{txHash:e}],"cancelPrivateTransaction")})}simulateAssetChangesBundle(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider(),i=n!==void 0?[e,n]:[e],s=yield r._send("alchemy_simulateAssetChangesBundle",i,"simulateAssetChangesBundle");return y(s)})}simulateAssetChanges(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider(),i=n!==void 0?[e,n]:[e],s=yield r._send("alchemy_simulateAssetChanges",i,"simulateAssetChanges");return y(s)})}simulateExecutionBundle(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider(),i=n!==void 0?[e,n]:[e],s=r._send("alchemy_simulateExecutionBundle",i,"simulateExecutionBundle");return y(s)})}simulateExecution(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getProvider(),i=n!==void 0?[e,n]:[e],s=r._send("alchemy_simulateExecution",i,"simulateExecution");return y(s)})}getTransaction(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).getTransaction(e)})}sendTransaction(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).sendTransaction(e)})}estimateGas(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).estimateGas(e)})}getMaxPriorityFeePerGas(){return a(this,void 0,void 0,function*(){const n=yield(yield this.config.getProvider())._send("eth_maxPriorityFeePerGas",[],"getMaxPriorityFeePerGas");return _(n)})}waitForTransaction(e,n,r){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider()).waitForTransaction(e,n,r)})}sendGasOptimizedTransaction(e,n){return a(this,void 0,void 0,function*(){if(Array.isArray(e))return this._sendGasOptimizedTransaction(e,"sendGasOptimizedTransactionPreSigned");let r,i,s;const o=yield this.config.getProvider();try{r=yield this.estimateGas(e),i=yield this.getMaxPriorityFeePerGas(),s=(yield o.getBlock("latest")).baseFeePerGas.toNumber()}catch(c){throw new Error(`Failed to estimate gas for transaction: ${c}`)}const d=Zn(e,r.toNumber(),s,i),u=yield Promise.all(d.map(c=>n.signTransaction(c)));return this._sendGasOptimizedTransaction(u,"sendGasOptimizedTransactionGenerated")})}getGasOptimizedTransactionStatus(e){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider())._send("alchemy_getGasOptimizedTransactionStatus",[e],"getGasOptimizedTransactionStatus")})}_sendGasOptimizedTransaction(e,n){return a(this,void 0,void 0,function*(){return(yield this.config.getProvider())._send("alchemy_sendGasOptimizedTransaction",[{rawTransactions:e}],n)})}}function Zn(t,e,n,r){return $n.map(i=>Object.assign(Object.assign({},t),{gasLimit:e,maxFeePerGas:Math.round(n*i+r*i),maxPriorityFeePerGas:Math.round(i*r)}))}const K="alchemy-pending-transactions",G="alchemy-mined-transactions",Y=[K,G];class Qn{constructor(e,n,r){this.listener=n,this.tag=e,this.once=r,this._lastBlockNumber=-2,this._inflight=!1}get event(){switch(this.type){case"tx":return this.hash;case"filter":return this.filter;default:return this.tag}}get type(){return this.tag.split(":")[0]}get hash(){const e=this.tag.split(":");if(e[0]!=="tx")throw new Error("Not a transaction event");return e[1]}get filter(){const e=this.tag.split(":");if(e[0]!=="filter")throw new Error("Not a transaction event");const n=e[1],r=ir(e[2]),i={};return r.length>0&&(i.topics=r),n&&n!=="*"&&(i.address=n),i}pollable(){const e=["block","network","pending","poll"];return this.tag.indexOf(":")>=0||e.indexOf(this.tag)>=0}}class Jn extends Qn{get fromAddress(){const e=this.tag.split(":");if(e[0]===K&&e[1]&&e[1]!=="*")return qe(e[1])}get toAddress(){const e=this.tag.split(":");if(e[0]===K&&e[2]&&e[2]!=="*")return qe(e[2])}get hashesOnly(){const e=this.tag.split(":");if(Y.includes(e[0])&&e[3]&&e[3]!=="*")return e[3]==="true"}get includeRemoved(){const e=this.tag.split(":");if(e[0]===G&&e[2]&&e[2]!=="*")return e[2]==="true"}get addresses(){const e=this.tag.split(":");if(e[0]===G&&e[1]&&e[1]!=="*")return sr(e[1])}}function M(t){return typeof t=="object"&&"method"in t}function x(t){if(!M(t))throw new Error("Event tag requires AlchemyEventType");if(t.method===O.PENDING_TRANSACTIONS)return tr(t);if(t.method===O.MINED_TRANSACTIONS)return nr(t);throw new Error(`Unrecognized AlchemyFilterEvent: ${t}`)}function er(t){if(!Object.values(O).includes(t.method))throw new Error(`Invalid method name ${t.method}. Accepted method names: ${Object.values(O)}`)}function tr(t){const e=ne(t.fromAddress),n=ne(t.toAddress),r=ye(t.hashesOnly);return K+":"+e+":"+n+":"+r}function nr(t){const e=rr(t.addresses),n=ye(t.includeRemoved),r=ye(t.hashesOnly);return G+":"+e+":"+n+":"+r}function rr(t){return t===void 0?"*":t.map(e=>ne(e.to)+","+ne(e.from)).join("|")}function ne(t){return t===void 0?"*":Array.isArray(t)?t.join("|"):t}function ye(t){return t===void 0?"*":t.toString()}function ir(t){return t===""?[]:t.split(/&/g).map(e=>{if(e==="")return[];const n=e.split("|").map(r=>r==="null"?null:r);return n.length===1?n[0]:n})}function qe(t){if(t==="")return;const e=t.split("|");return e.length===1?e[0]:e}function sr(t){if(t!=="")return t.split("|").map(e=>e.split(",")).map(e=>Object.assign(Object.assign({},e[0]!=="*"&&{to:e[0]}),e[1]!=="*"&&{from:e[1]}))}class or{constructor(e){this.config=e}on(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getWebSocketProvider(),i=yield this._resolveEnsAlchemyEvent(e);r.on(i,n)}),this}once(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getWebSocketProvider(),i=yield this._resolveEnsAlchemyEvent(e);r.once(i,n)}),this}off(e,n){return a(this,void 0,void 0,function*(){const r=yield this.config.getWebSocketProvider(),i=yield this._resolveEnsAlchemyEvent(e);return r.off(i,n)}),this}removeAllListeners(e){return a(this,void 0,void 0,function*(){const n=yield this.config.getWebSocketProvider(),r=e?yield this._resolveEnsAlchemyEvent(e):void 0;n.removeAllListeners(r)}),this}listenerCount(e){return a(this,void 0,void 0,function*(){const n=yield this.config.getWebSocketProvider(),r=e?yield this._resolveEnsAlchemyEvent(e):void 0;return n.listenerCount(r)})}listeners(e){return a(this,void 0,void 0,function*(){const n=yield this.config.getWebSocketProvider(),r=e?yield this._resolveEnsAlchemyEvent(e):void 0;return n.listeners(r)})}_resolveEnsAlchemyEvent(e){return a(this,void 0,void 0,function*(){if(!M(e))return e;if(e.method===O.MINED_TRANSACTIONS&&e.addresses){const n=[];for(const r of e.addresses)r.to&&(r.to=yield this._resolveNameOrError(r.to)),r.from&&(r.from=yield this._resolveNameOrError(r.from)),n.push(r);e.addresses=n}else e.method===O.PENDING_TRANSACTIONS&&(e.fromAddress&&(typeof e.fromAddress=="string"?e.fromAddress=yield this._resolveNameOrError(e.fromAddress):e.fromAddress=yield Promise.all(e.fromAddress.map(n=>this._resolveNameOrError(n)))),e.toAddress&&(typeof e.toAddress=="string"?e.toAddress=yield this._resolveNameOrError(e.toAddress):e.toAddress=yield Promise.all(e.toAddress.map(n=>this._resolveNameOrError(n)))));return e})}_resolveNameOrError(e){return a(this,void 0,void 0,function*(){const r=yield(yield this.config.getProvider()).resolveName(e);if(r===null)throw new Error(`Unable to resolve the ENS address: ${e}`);return r})}}class Dr{constructor(e){this.config=new wt(e),this.core=new Zt(this.config),this.nft=new jn(this.config),this.ws=new or(this.config),this.transact=new Xn(this.config),this.notify=new Wn(this.config),this.debug=new Qt(this.config)}}const ar=100,cr=10;class dr{constructor(e,n=ar){this.sendBatchFn=e,this.maxBatchSize=n,this.pendingBatch=[]}enqueueRequest(e){return a(this,void 0,void 0,function*(){const n={request:e,resolve:void 0,reject:void 0},r=new Promise((i,s)=>{n.resolve=i,n.reject=s});return this.pendingBatch.push(n),this.pendingBatch.length===this.maxBatchSize?this.sendBatchRequest():this.pendingBatchTimer||(this.pendingBatchTimer=setTimeout(()=>this.sendBatchRequest(),cr)),r})}sendBatchRequest(){return a(this,void 0,void 0,function*(){const e=this.pendingBatch;this.pendingBatch=[],this.pendingBatchTimer&&(clearTimeout(this.pendingBatchTimer),this.pendingBatchTimer=void 0);const n=e.map(r=>r.request);return this.sendBatchFn(n).then(r=>{e.forEach((i,s)=>{const o=r[s];if(o.error){const d=new Error(o.error.message);d.code=o.error.code,d.data=o.error.data,i.reject(d)}else i.resolve(o.result)})},r=>{e.forEach(i=>{i.reject(r)})})})}}class F extends Nt{constructor(e){const n=F.getApiKey(e.apiKey),r=F.getAlchemyNetwork(e.network);let i=F.getAlchemyConnectionInfo(r,n,"http");e.url!==void 0&&(i.url=e.url),i.throttleLimit=e.maxRetries,e.connectionInfoOverrides&&(i=Object.assign(Object.assign({},i),e.connectionInfoOverrides));const s=nt[r];super(i,s),this.apiKey=e.apiKey,this.maxRetries=e.maxRetries,this.batchRequests=e.batchRequests;const o=Object.assign(Object.assign({},this.connection),{headers:Object.assign(Object.assign({},this.connection.headers),{"Alchemy-Ethers-Sdk-Method":"batchSend"})}),d=u=>be(o,JSON.stringify(u));this.batcher=new dr(d),this.modifyFormatter()}static getApiKey(e){if(e==null)return J;if(e&&typeof e!="string")throw new Error(`Invalid apiKey '${e}' provided. apiKey must be a string.`);return e}static getNetwork(e){return typeof e=="string"&&e in ee?ee[e]:Qe(e)}static getAlchemyNetwork(e){if(e===void 0)return et;if(typeof e=="number")throw new Error(`Invalid network '${e}' provided. Network must be a string.`);if(!Object.values(l).includes(e))throw new Error(`Invalid network '${e}' provided. Network must be one of: ${Object.values(l).join(", ")}.`);return e}static getAlchemyConnectionInfo(e,n,r){const i=r==="http"?tt(e,n):kt(e,n);return{headers:dt?{"Alchemy-Ethers-Sdk-Version":te}:{"Alchemy-Ethers-Sdk-Version":te,"Accept-Encoding":"gzip"},allowGzip:!0,url:i}}detectNetwork(){const e=Object.create(null,{detectNetwork:{get:()=>super.detectNetwork}});return a(this,void 0,void 0,function*(){let n=this.network;if(n==null&&(n=yield e.detectNetwork.call(this),!n))throw new Error("No network detected");return n})}_startPending(){nn("WARNING: Alchemy Provider does not support pending filters")}isCommunityResource(){return this.apiKey===J}send(e,n){return this._send(e,n,"send")}_send(e,n,r,i=!1){const s={method:e,params:n,id:this._nextId++,jsonrpc:"2.0"},o=Object.assign({},this.connection);if(o.headers["Alchemy-Ethers-Sdk-Method"]=r,this.batchRequests||i)return this.batcher.enqueueRequest(s);this.emit("debug",{action:"request",request:ve(s),provider:this});const d=["eth_chainId","eth_blockNumber"].indexOf(e)>=0;if(d&&this._cache[e])return this._cache[e];const u=be(this.connection,JSON.stringify(s),lr).then(c=>(this.emit("debug",{action:"response",request:s,response:c,provider:this}),c),c=>{throw this.emit("debug",{action:"response",error:c,request:s,provider:this}),c});return d&&(this._cache[e]=u,setTimeout(()=>{this._cache[e]=null},0)),u}modifyFormatter(){this.formatter.formats.receiptLog.removed=e=>{if(typeof e=="boolean")return e}}}function lr(t){if(t.error){const e=new Error(t.error.message);throw e.code=t.error.code,e.data=t.error.data,e}return t.result}const ur=Object.freeze(Object.defineProperty({__proto__:null,AlchemyProvider:F},Symbol.toStringTag,{value:"Module"})),hr=120;class fr{constructor(e){this.provider=e,this.maxBackfillBlocks=hr}getNewHeadsBackfill(e,n,r){return a(this,void 0,void 0,function*(){p(e);const i=yield this.getBlockNumber();if(p(e),n.length===0)return this.getHeadEventsInRange(Math.max(r,i-this.maxBackfillBlocks)+1,i+1);const s=_(n[n.length-1].number),o=i-this.maxBackfillBlocks+1;if(s<=o)return this.getHeadEventsInRange(o,i+1);const d=yield this.getReorgHeads(e,n);p(e);const u=yield this.getHeadEventsInRange(s+1,i+1);return p(e),[...d,...u]})}getLogsBackfill(e,n,r,i){return a(this,void 0,void 0,function*(){p(e);const s=yield this.getBlockNumber();if(p(e),r.length===0)return this.getLogsInRange(n,Math.max(i,s-this.maxBackfillBlocks)+1,s+1);const o=_(r[r.length-1].blockNumber),d=s-this.maxBackfillBlocks+1;if(o<d)return this.getLogsInRange(n,d,s+1);const u=yield this.getCommonAncestor(e,r);p(e);const c=r.filter(f=>_(f.blockNumber)>u.blockNumber).map(f=>Object.assign(Object.assign({},f),{removed:!0})),h=u.blockNumber===Number.NEGATIVE_INFINITY?_(r[0].blockNumber):u.blockNumber;let m=yield this.getLogsInRange(n,h,s+1);return m=m.filter(f=>f&&(_(f.blockNumber)>u.blockNumber||_(f.logIndex)>u.logIndex)),p(e),[...c,...m]})}setMaxBackfillBlock(e){this.maxBackfillBlocks=e}getBlockNumber(){return a(this,void 0,void 0,function*(){const e=yield this.provider.send("eth_blockNumber");return _(e)})}getHeadEventsInRange(e,n){return a(this,void 0,void 0,function*(){if(e>=n)return[];const r=[];for(let s=e;s<n;s++)r.push({method:"eth_getBlockByNumber",params:[B(s),!1]});return(yield this.provider.sendBatch(r)).map(Ve)})}getReorgHeads(e,n){return a(this,void 0,void 0,function*(){const r=[];for(let i=n.length-1;i>=0;i--){const s=n[i],o=yield this.getBlockByNumber(_(s.number));if(p(e),s.hash===o.hash)break;r.push(Ve(o))}return r.reverse()})}getBlockByNumber(e){return a(this,void 0,void 0,function*(){return this.provider.send("eth_getBlockByNumber",[B(e),!1])})}getCommonAncestor(e,n){return a(this,void 0,void 0,function*(){let r=yield this.getBlockByNumber(_(n[n.length-1].blockNumber));p(e);for(let i=n.length-1;i>=0;i--){const s=n[i];if(s.blockNumber!==r.number&&(r=yield this.getBlockByNumber(_(s.blockNumber))),s.blockHash===r.hash)return{blockNumber:_(s.blockNumber),logIndex:_(s.logIndex)}}return{blockNumber:Number.NEGATIVE_INFINITY,logIndex:Number.NEGATIVE_INFINITY}})}getLogsInRange(e,n,r){return a(this,void 0,void 0,function*(){if(n>=r)return[];const i=Object.assign(Object.assign({},e),{fromBlock:B(n),toBlock:B(r-1)});return this.provider.send("eth_getLogs",[i])})}}function Ve(t){const e=Object.assign({},t);return delete e.totalDifficulty,delete e.transactions,delete e.uncles,e}function mr(t){return Et(t,e=>e.hash)}function vr(t){return Et(t,e=>`${e.blockHash}/${e.logIndex}`)}function Et(t,e){const n=new Set,r=[];return t.forEach(i=>{const s=e(i);n.has(s)||(n.add(s),r.push(i))}),r}const gr=new Error("Cancelled");function p(t){if(t())throw gr}const Er=3e4,Ar=1e4,Ye=6e4,$e=5,yr=10;class Tr extends pt{constructor(e,n){var r;const i=F.getApiKey(e.apiKey),s=F.getAlchemyNetwork(e.network),o=F.getAlchemyConnectionInfo(s,i,"wss"),d=`alchemy-sdk-${te}`,u=new It((r=e.url)!==null&&r!==void 0?r:o.url,d,{wsConstructor:n??_r()}),c=nt[s];super(u,c),this._events=[],this.virtualSubscriptionsById=new Map,this.virtualIdsByPhysicalId=new Map,this.handleMessage=h=>{const m=JSON.parse(h.data);if(!Sr(m))return;const f=m.params.subscription,v=this.virtualIdsByPhysicalId.get(f);if(!v)return;const C=this.virtualSubscriptionsById.get(v);if(C.method==="eth_subscribe")switch(C.params[0]){case"newHeads":{const L=C,oe=m,{isBackfilling:ae,backfillBuffer:ce}=L,{result:D}=oe.params;ae?Pr(ce,D):f!==v?this.emitAndRememberEvent(v,D,$):this.rememberEvent(v,D,$);break}case"logs":{const L=C,oe=m,{isBackfilling:ae,backfillBuffer:ce}=L,{result:D}=oe.params;ae?Cr(ce,D):v!==f?this.emitAndRememberEvent(v,D,X):this.rememberEvent(v,D,X);break}default:if(f!==v){const{result:L}=m.params;this.emitEvent(v,L)}}},this.handleReopen=()=>{this.virtualIdsByPhysicalId.clear();const{cancel:h,isCancelled:m}=pr();this.cancelBackfill=h;for(const f of this.virtualSubscriptionsById.values())a(this,void 0,void 0,function*(){try{yield this.resubscribeAndBackfill(m,f)}catch(v){m()||console.error(`Error while backfilling "${f.params[0]}" subscription. Some events may be missing.`,v)}});this.startHeartbeat()},this.stopHeartbeatAndBackfill=()=>{this.heartbeatIntervalId!=null&&(clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=void 0),this.cancelBackfill()},this.apiKey=i,this.backfiller=new fr(this),this.addSocketListeners(),this.startHeartbeat(),this.cancelBackfill=Pt}static getNetwork(e){return typeof e=="string"&&e in ee?ee[e]:Qe(e)}on(e,n){return this._addEventListener(e,n,!1)}once(e,n){return this._addEventListener(e,n,!0)}off(e,n){return M(e)?this._off(e,n):super.off(e,n)}removeAllListeners(e){return e!==void 0&&M(e)?this._removeAllListeners(e):super.removeAllListeners(e)}listenerCount(e){return e!==void 0&&M(e)?this._listenerCount(e):super.listenerCount(e)}listeners(e){return e!==void 0&&M(e)?this._listeners(e):super.listeners(e)}_addEventListener(e,n,r){if(M(e)){er(e);const i=new Jn(x(e),n,r);return this._events.push(i),this._startEvent(i),this}else return super._addEventListener(e,n,r)}_startEvent(e){[...Y,"block","filter"].includes(e.type)?this.customStartEvent(e):super._startEvent(e)}_subscribe(e,n,r,i){return a(this,void 0,void 0,function*(){let s=this._subIds[e];const o=yield this.getBlockNumber();s==null&&(s=Promise.all(n).then(c=>this.send("eth_subscribe",c)),this._subIds[e]=s);const d=yield s,u=yield Promise.all(n);this.virtualSubscriptionsById.set(d,{event:i,method:"eth_subscribe",params:u,startingBlockNumber:o,virtualId:d,physicalId:d,sentEvents:[],isBackfilling:!1,backfillBuffer:[]}),this.virtualIdsByPhysicalId.set(d,d),this._subs[d]={tag:e,processFunc:r}})}emit(e,...n){if(M(e)){let r=!1;const i=[],s=x(e);return this._events=this._events.filter(o=>o.tag!==s?!0:(setTimeout(()=>{o.listener.apply(this,n)},0),r=!0,o.once?(i.push(o),!1):!0)),i.forEach(o=>{this._stopEvent(o)}),r}else return super.emit(e,...n)}sendBatch(e){return a(this,void 0,void 0,function*(){let n=0;const r=e.map(({method:i,params:s})=>({method:i,params:s,jsonrpc:"2.0",id:`alchemy-sdk:${n++}`}));return this.sendBatchConcurrently(r)})}destroy(){return this.removeSocketListeners(),this.stopHeartbeatAndBackfill(),super.destroy()}isCommunityResource(){return this.apiKey===J}_stopEvent(e){let n=e.tag;if(Y.includes(e.type)){if(this._events.filter(i=>Y.includes(i.type)).length)return}else if(e.type==="tx"){if(this._events.filter(i=>i.type==="tx").length)return;n="tx"}else if(this.listenerCount(e.event))return;const r=this._subIds[n];r&&(delete this._subIds[n],r.then(i=>{this._subs[i]&&(delete this._subs[i],this.send("eth_unsubscribe",[i]))}))}addSocketListeners(){this._websocket.addEventListener("message",this.handleMessage),this._websocket.addEventListener("reopen",this.handleReopen),this._websocket.addEventListener("down",this.stopHeartbeatAndBackfill)}removeSocketListeners(){this._websocket.removeEventListener("message",this.handleMessage),this._websocket.removeEventListener("reopen",this.handleReopen),this._websocket.removeEventListener("down",this.stopHeartbeatAndBackfill)}resubscribeAndBackfill(e,n){return a(this,void 0,void 0,function*(){const{virtualId:r,method:i,params:s,sentEvents:o,backfillBuffer:d,startingBlockNumber:u}=n;n.isBackfilling=!0,d.length=0;try{const c=yield this.send(i,s);switch(p(e),n.physicalId=c,this.virtualIdsByPhysicalId.set(c,r),s[0]){case"newHeads":{const h=yield Xe(()=>le(this.backfiller.getNewHeadsBackfill(e,o,u),Ye),$e,()=>!e());p(e),mr([...h,...d]).forEach(f=>this.emitNewHeadsEvent(r,f));break}case"logs":{const h=s[1]||{},m=yield Xe(()=>le(this.backfiller.getLogsBackfill(e,h,o,u),Ye),$e,()=>!e());p(e),vr([...m,...d]).forEach(v=>this.emitLogsEvent(r,v));break}default:break}}finally{n.isBackfilling=!1,d.length=0}})}emitNewHeadsEvent(e,n){this.emitAndRememberEvent(e,n,$)}emitLogsEvent(e,n){this.emitAndRememberEvent(e,n,X)}emitAndRememberEvent(e,n,r){this.rememberEvent(e,n,r),this.emitEvent(e,n)}emitEvent(e,n){const r=this.virtualSubscriptionsById.get(e);r&&this.emitGenericEvent(r,n)}rememberEvent(e,n,r){const i=this.virtualSubscriptionsById.get(e);i&&pe(i.sentEvents,Object.assign({},n),r)}emitGenericEvent(e,n){this.emitProcessFn(e.event)(n)}startHeartbeat(){this.heartbeatIntervalId==null&&(this.heartbeatIntervalId=setInterval(()=>a(this,void 0,void 0,function*(){try{yield le(this.send("net_version"),Ar)}catch{this._websocket.reconnect()}}),Er))}sendBatchConcurrently(e){return a(this,void 0,void 0,function*(){return Promise.all(e.map(n=>this.send(n.method,n.params)))})}customStartEvent(e){if(e.type===K){const{fromAddress:n,toAddress:r,hashesOnly:i}=e;this._subscribe(e.tag,[O.PENDING_TRANSACTIONS,{fromAddress:n,toAddress:r,hashesOnly:i}],this.emitProcessFn(e),e)}else if(e.type===G){const{addresses:n,includeRemoved:r,hashesOnly:i}=e;this._subscribe(e.tag,[O.MINED_TRANSACTIONS,{addresses:n,includeRemoved:r,hashesOnly:i}],this.emitProcessFn(e),e)}else e.type==="block"?this._subscribe("block",["newHeads"],this.emitProcessFn(e),e):e.type==="filter"&&this._subscribe(e.tag,["logs",this._getFilter(e.filter)],this.emitProcessFn(e),e)}emitProcessFn(e){switch(e.type){case K:return n=>this.emit({method:O.PENDING_TRANSACTIONS,fromAddress:e.fromAddress,toAddress:e.toAddress,hashesOnly:e.hashesOnly},n);case G:return n=>this.emit({method:O.MINED_TRANSACTIONS,addresses:e.addresses,includeRemoved:e.includeRemoved,hashesOnly:e.hashesOnly},n);case"block":return n=>{const r=N.from(n.number).toNumber();this._emitted.block=r,this.emit("block",r)};case"filter":return n=>{n.removed==null&&(n.removed=!1),this.emit(e.filter,this.formatter.filterLog(n))};default:throw new Error("Invalid event type to `emitProcessFn()`")}}_off(e,n){if(n==null)return this.removeAllListeners(e);const r=[];let i=!1;const s=x(e);return this._events=this._events.filter(o=>o.tag!==s||o.listener!=n||i?!0:(i=!0,r.push(o),!1)),r.forEach(o=>{this._stopEvent(o)}),this}_removeAllListeners(e){let n=[];if(e==null)n=this._events,this._events=[];else{const r=x(e);this._events=this._events.filter(i=>i.tag!==r?!0:(n.push(i),!1))}return n.forEach(r=>{this._stopEvent(r)}),this}_listenerCount(e){if(!e)return this._events.length;const n=x(e);return this._events.filter(r=>r.tag===n).length}_listeners(e){if(e==null)return this._events.map(r=>r.listener);const n=x(e);return this._events.filter(r=>r.tag===n).map(r=>r.listener)}}function _r(){return Nr()?require("websocket").w3cwebsocket:WebSocket}function Nr(){return typeof process<"u"&&process!=null&&process.versions!=null&&process.versions.node!=null}function pr(){let t=!1;return{cancel:()=>t=!0,isCancelled:()=>t}}const Ir=1e3,br=2,Or=3e4;function Xe(t,e,n=()=>!0){return a(this,void 0,void 0,function*(){let r=0,i=0;for(;;)try{return yield t()}catch(s){if(i++,i>=e||!n(s)||(yield Rr(r),!n(s)))throw s;r=r===0?Ir:Math.min(Or,br*r)}})}function Rr(t){return new Promise(e=>setTimeout(e,t))}function le(t,e){return Promise.race([t,new Promise((n,r)=>setTimeout(()=>r(new Error("Timeout")),e))])}function $(t){return _(t.number)}function X(t){return _(t.blockNumber)}function kr(t){return Array.isArray(t)||t.jsonrpc==="2.0"&&t.id!==void 0}function Sr(t){return!kr(t)}function Pr(t,e){pe(t,e,$)}function Cr(t,e){pe(t,e,X)}function pe(t,e,n){const r=n(e),i=t.findIndex(s=>n(s)>r-yr);i===-1?t.length=0:t.splice(0,i),t.push(e)}const wr=Object.freeze(Object.defineProperty({__proto__:null,AlchemyWebSocketProvider:Tr},Symbol.toStringTag,{value:"Module"}));export{Dr as A,l as N};
