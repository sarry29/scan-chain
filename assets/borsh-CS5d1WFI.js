import{c}from"./@ethersproject-w92F1kWw.js";import{b as E}from"./bn.js-BUi-eOe1.js";import{a as x}from"./bs58-D21jO5-q.js";import{r as A}from"./text-encoding-utf-8-CsV-buPx.js";var f={},$=c&&c.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),F=c&&c.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),h=c&&c.__decorate||function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var d=n.length-1;d>=0;d--)(s=n[d])&&(o=(i<3?s(o):i>3?s(e,t,o):s(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},O=c&&c.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&$(e,n,t);return F(e,n),e},B=c&&c.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(f,"__esModule",{value:!0});var D=f.deserializeUnchecked=C=f.deserialize=L=f.serialize=f.BinaryReader=f.BinaryWriter=f.BorshError=f.baseDecode=f.baseEncode=void 0;const b=B(E),_=B(x),v=O(A),P=typeof TextDecoder!="function"?v.TextDecoder:TextDecoder,S=new P("utf-8",{fatal:!0});function k(n){return typeof n=="string"&&(n=Buffer.from(n,"utf8")),_.default.encode(Buffer.from(n))}f.baseEncode=k;function I(n){return Buffer.from(_.default.decode(n))}f.baseDecode=I;const U=1024;class u extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}f.BorshError=u;class p{constructor(){this.buf=Buffer.alloc(U),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc(U)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(Buffer.from(new b.default(e).toArray("le",64)))}writeBuffer(e){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),e,Buffer.alloc(U)]),this.length+=e.length}writeString(e){this.maybeResize();const t=Buffer.from(e,"utf8");this.writeU32(t.length),this.writeBuffer(t)}writeFixedArray(e){this.writeBuffer(Buffer.from(e))}writeArray(e,t){this.maybeResize(),this.writeU32(e.length);for(const r of e)this.maybeResize(),t(r)}toArray(){return this.buf.subarray(0,this.length)}}f.BinaryWriter=p;function l(n,e,t){const r=t.value;t.value=function(...i){try{return r.apply(this,i)}catch(o){if(o instanceof RangeError){const s=o.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(s)>=0)throw new u("Reached the end of buffer when deserializing")}throw o}}}class a{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new b.default(e,"le")}readU128(){const e=this.readBuffer(16);return new b.default(e,"le")}readU256(){const e=this.readBuffer(32);return new b.default(e,"le")}readU512(){const e=this.readBuffer(64);return new b.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new u(`Expected buffer length ${e} isn't within bounds`);const t=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,t}readString(){const e=this.readU32(),t=this.readBuffer(e);try{return S.decode(t)}catch(r){throw new u(`Error decoding UTF-8 string: ${r}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const t=this.readU32(),r=Array();for(let i=0;i<t;++i)r.push(e());return r}}h([l],a.prototype,"readU8",null);h([l],a.prototype,"readU16",null);h([l],a.prototype,"readU32",null);h([l],a.prototype,"readU64",null);h([l],a.prototype,"readU128",null);h([l],a.prototype,"readU256",null);h([l],a.prototype,"readU512",null);h([l],a.prototype,"readString",null);h([l],a.prototype,"readFixedArray",null);h([l],a.prototype,"readArray",null);f.BinaryReader=a;function z(n){return n.charAt(0).toUpperCase()+n.slice(1)}function w(n,e,t,r,i){try{if(typeof r=="string")i[`write${z(r)}`](t);else if(r instanceof Array)if(typeof r[0]=="number"){if(t.length!==r[0])throw new u(`Expecting byte array of length ${r[0]}, but got ${t.length} bytes`);i.writeFixedArray(t)}else if(r.length===2&&typeof r[1]=="number"){if(t.length!==r[1])throw new u(`Expecting byte array of length ${r[1]}, but got ${t.length} bytes`);for(let o=0;o<r[1];o++)w(n,null,t[o],r[0],i)}else i.writeArray(t,o=>{w(n,e,o,r[0],i)});else if(r.kind!==void 0)switch(r.kind){case"option":{t==null?i.writeU8(0):(i.writeU8(1),w(n,e,t,r.type,i));break}case"map":{i.writeU32(t.size),t.forEach((o,s)=>{w(n,e,s,r.key,i),w(n,e,o,r.value,i)});break}default:throw new u(`FieldType ${r} unrecognized`)}else m(n,t,i)}catch(o){throw o instanceof u&&o.addToFieldPath(e),o}}function m(n,e,t){if(typeof e.borshSerialize=="function"){e.borshSerialize(t);return}const r=n.get(e.constructor);if(!r)throw new u(`Class ${e.constructor.name} is missing in schema`);if(r.kind==="struct")r.fields.map(([i,o])=>{w(n,i,e[i],o,t)});else if(r.kind==="enum"){const i=e[r.field];for(let o=0;o<r.values.length;++o){const[s,d]=r.values[o];if(s===i){t.writeU8(o),w(n,s,e[s],d,t);break}}}else throw new u(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function M(n,e,t=p){const r=new t;return m(n,e,r),r.toArray()}var L=f.serialize=M;function g(n,e,t,r){try{if(typeof t=="string")return r[`read${z(t)}`]();if(t instanceof Array){if(typeof t[0]=="number")return r.readFixedArray(t[0]);if(typeof t[1]=="number"){const i=[];for(let o=0;o<t[1];o++)i.push(g(n,null,t[0],r));return i}else return r.readArray(()=>g(n,e,t[0],r))}if(t.kind==="option")return r.readU8()?g(n,e,t.type,r):void 0;if(t.kind==="map"){let i=new Map;const o=r.readU32();for(let s=0;s<o;s++){const d=g(n,e,t.key,r),R=g(n,e,t.value,r);i.set(d,R)}return i}return y(n,t,r)}catch(i){throw i instanceof u&&i.addToFieldPath(e),i}}function y(n,e,t){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(t);const r=n.get(e);if(!r)throw new u(`Class ${e.name} is missing in schema`);if(r.kind==="struct"){const i={};for(const[o,s]of n.get(e).fields)i[o]=g(n,o,s,t);return new e(i)}if(r.kind==="enum"){const i=t.readU8();if(i>=r.values.length)throw new u(`Enum index: ${i} is out of range`);const[o,s]=r.values[i],d=g(n,o,s,t);return new e({[o]:d})}throw new u(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function j(n,e,t,r=a){const i=new r(t),o=y(n,e,i);if(i.offset<t.length)throw new u(`Unexpected ${t.length-i.offset} bytes after deserialized data`);return o}var C=f.deserialize=j;function G(n,e,t,r=a){const i=new r(t);return y(n,e,i)}D=f.deserializeUnchecked=G;export{D as a,C as d,L as s};
